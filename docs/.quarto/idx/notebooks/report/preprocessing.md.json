{"title":"Preprocessing Pipelines","markdown":{"headingText":"Preprocessing Pipelines","containsRefs":false,"markdown":"\nConsistent and appropriate preprocessing is crucial for effective modeling. While our feature engineering (detailed previously) was performed entirely in R, the final preprocessing steps before model training were handled slightly differently within the R and Python frameworks.\n\n## R `tidymodels` Preprocessing (`recipes`)\n\nFor the models trained using the R `tidymodels` ecosystem (MARS, Random Forest, XGBoost), we defined a standardized preprocessing pipeline using the `recipes` package. This object, created by the `create_recipe` function in `src/r/recipes/recipes.R`, encapsulated the necessary steps to prepare the engineered data for these specific algorithms.\n\nKey steps included:\n\n- **Role Definition**: Assigning 'outcome' and 'predictor' roles to variables.\n- **Variable Removal**: Removing identifier columns, raw date/time fields (after extracting relevant features like minutes past midnight), and the *other* target variable not being predicted in a given run.\n- **Time Conversion**: Transforming `Check_In_Time` into a numeric `Check_In_Time_Minutes` feature.\n- **Imputation**: Handling missing numeric values using mean imputation (`step_impute_mean`).\n- **Categorical Handling**: Preparing for potential new factor levels during resampling (`step_novel`) and converting nominal predictors to numeric using dummy variables (`step_dummy` with `one_hot = FALSE` to mimic pandas `drop_first=True`).\n- **Variance Filtering**: Removing predictors with zero variance (`step_zv`), often necessary after dummy coding.\n- **Normalization**: Centering and scaling all numeric predictors (`step_normalize`).\n\nThis approach ensured that the data fed into the `tidymodels` workflows was consistently processed according to the needs of the algorithms.\n\n```r\n# Example recipe creation (from src/r/recipes/recipes.R)\ncreate_recipe <- function(data, outcome_var, features_to_drop) {\n    # ... (Input validation) ...\n    other_target <- setdiff(c(\"Duration_In_Min\", \"Occupancy\"), outcome_var)\n    all_drops <- unique(c(features_to_drop, other_target))\n    outcome_sym <- rlang::sym(outcome_var)\n\n    rec <- recipe(data) %>%\n        update_role(!!outcome_sym, new_role = \"outcome\") %>%\n        update_role(all_nominal(), -all_outcomes(), new_role = \"predictor\") %>%\n        update_role(all_numeric(), -all_outcomes(), new_role = \"predictor\") %>%\n        step_rm(dplyr::any_of(all_drops)) %>%\n        step_mutate(Check_In_Time_Minutes = (lubridate::hour(lubridate::hms(Check_In_Time)) * 60 +\n            lubridate::minute(lubridate::hms(Check_In_Time)))) %>%\n        step_rm(Check_In_Time) %>%\n        step_rm(dplyr::any_of(c(\"Check_In_Date\", \"Semester_Date\", \"Expected_Graduation_Date\"))) %>%\n        step_impute_mean(all_numeric_predictors()) %>%\n        step_novel(all_nominal_predictors()) %>%\n        step_dummy(all_nominal_predictors(), one_hot = FALSE) %>%\n        step_zv(all_predictors()) %>%\n        step_normalize(all_numeric_predictors())\n\n    return(rec)\n}\n```\n\n## Python Framework Preprocessing\n\nFor the neural network models (MLP, GRU) implemented in Python using PyTorch, the preprocessing started with the output of the R feature engineering process (typically loaded as CSV or parquet files into pandas DataFrames).\n\nKey Python preprocessing steps included:\n\n- **Column Dropping**: Removing identifier columns or other raw features not directly used by the models.\n- **Column Alignment**: Ensuring consistency in the feature set between training, validation, and holdout splits. Since dummy variables were created in the R `recipe` step, this involved adding columns with zero values if they were present in the training set but not a validation/holdout fold, and removing columns present in validation/holdout but not training.\n- **Boolean Conversion**: Converting any remaining boolean columns (often resulting from dummy encoding) to integer format (0 or 1).\n- **Feature Scaling**: Applying `sklearn.preprocessing.StandardScaler` to all numeric features. Crucially, the scaler was *fit only* on the training portion of the data (the 75% used for CV) and then used to *transform* the training, validation, and holdout sets.\n\nThese steps prepared the data specifically for ingestion by the PyTorch models and DataLoaders. ","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"toc-depth":3,"number-sections":false,"output-file":"preprocessing.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.43","theme":"united"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html","revealjs"]}